<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Adding Behaviors &mdash; fjåge 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="fjåge 1.0.1 documentation" href="index.html" />
    <link rel="next" title="Passing Messages" href="messages.html" />
    <link rel="prev" title="Getting Started" href="quickstart.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="messages.html" title="Passing Messages"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="quickstart.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">fjåge 1.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Adding Behaviors</a><ul>
<li><a class="reference internal" href="#agent-lifecycle">Agent lifecycle</a></li>
<li><a class="reference internal" href="#one-shot-behavior">One-shot behavior</a></li>
<li><a class="reference internal" href="#cyclic-behavior">Cyclic behavior</a></li>
<li><a class="reference internal" href="#waker-behavior">Waker behavior</a></li>
<li><a class="reference internal" href="#ticker-behavior">Ticker behavior</a></li>
<li><a class="reference internal" href="#poisson-behavior">Poisson behavior</a></li>
<li><a class="reference internal" href="#message-behavior">Message behavior</a></li>
<li><a class="reference internal" href="#finite-state-machine-behavior">Finite state machine behavior</a></li>
<li><a class="reference internal" href="#test-behavior">Test behavior</a></li>
<li><a class="reference internal" href="#custom-behaviors">Custom behaviors</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="quickstart.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="messages.html"
                        title="next chapter">Passing Messages</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="adding-behaviors">
<h1>Adding Behaviors<a class="headerlink" href="#adding-behaviors" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Work in progress</p>
</div>
<div class="section" id="agent-lifecycle">
<h2>Agent lifecycle<a class="headerlink" href="#agent-lifecycle" title="Permalink to this headline">¶</a></h2>
<p>When an agent is added to a container, it starts in the INIT state. When the platform is running, agents in the INIT state are initialized by calling their <cite>init()</cite> method. An typical agent overrides this method and adds new behaviors to itself.</p>
<p>After initialization, the agent moves to a RUNNING state. In this state, active behaviors of the agent are scheduled to run. A typical agent is associated with one agent thread, and various behaviors are cooperatively scheduled on this thread. Due to the cooperative nature of the behaviors, a poorly written behavior may block execution of all other behaviors of that agent. Developers should avoid long-running or blocking code in behaviors; if such code is needed, it is best to create a separate thread to run that code.</p>
<p>A behavior that is not ready to run may be in a blocked state (e.g. a behavior that is to be executed at a specified later time). An agent may make a behavior as blocked, by explicitly calling the <cite>block()</cite> method on that behavior. If there are no active behaviors for an agent, the agent goes into an IDLE state. Behaviors may be activated due to timer events, message delivery events or by explicit <cite>restart()</cite> method calls. When one or more behaviors become active, the agent goes back into a RUNNING state.</p>
<p>When an agent is killed or the platform is shutdown, the agent is placed in a FINISHING state. Agents in this state are given a chance to cleanup via a call to their <cite>shutdown()</cite> method. An agent may override this method if a cleanup is required. After the cleanup, the agent is terminated and placed in a FINISHED state, and removed from the container.</p>
<p>An example skeleton agent is shown below:</p>
<div class="highlight-groovy"><div class="highlight"><pre><span class="kd">class</span> <span class="nc">MyAgent</span> <span class="kd">extends</span> <span class="n">Agent</span> <span class="o">{</span>

  <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// agent is in INIT state</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span> <span class="s1">&#39;Agent init&#39;</span>
    <span class="n">add</span> <span class="n">oneShotBehavior</span> <span class="o">{</span>
      <span class="c1">// behavior will be executed after all agents are initialized</span>
      <span class="c1">// agent is in RUNNING state</span>
      <span class="n">log</span><span class="o">.</span><span class="na">info</span> <span class="s1">&#39;Agent ready&#39;</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span> <span class="s1">&#39;Agent shutdown&#39;</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><cite>println()</cite> from an agent is mapped to <cite>log.info()</cite>, and can be used interchangably. However, the <cite>log</cite> object provides more flexibility (e.g. <cite>log.warning()</cite>, <cite>log.fine()</cite>, etc).</p>
</div>
<p>The <em>traditional</em> behavior creation style may be used by Java and Groovy agents:</p>
<div class="highlight-groovy"><div class="highlight"><pre><span class="n">agent</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">OneShotBehavior</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// do something</span>
  <span class="o">}</span>
<span class="o">});</span>
</pre></div>
</div>
<p>The method to override depends on the behavior (e.g. <cite>action()</cite> for most behaviors, but <cite>onTick()</cite> for <cite>TickerBehavior</cite>, and <cite>onWake()</cite> for <cite>WakerBehavior</cite>).</p>
<p>Groovy agents support a simpler alternative syntax if the <cite>GroovyAgentExtensions</cite> are enabled (see chapter &#8220;<a class="reference internal" href="java.html#java"><em>Groovy vs Java Agents</em></a>&#8221; for more details):</p>
<div class="highlight-groovy"><div class="highlight"><pre><span class="n">agent</span><span class="o">.</span><span class="na">add</span> <span class="n">oneShotBehavior</span> <span class="o">{</span>
  <span class="c1">// do something</span>
<span class="o">}</span>
</pre></div>
</div>
<p>With this syntax, the appropriate method is automatically overridden to call the defined closure. For the examples in the rest of this chapter, we will adopt the simpler Groovy syntax.</p>
</div>
<div class="section" id="one-shot-behavior">
<h2>One-shot behavior<a class="headerlink" href="#one-shot-behavior" title="Permalink to this headline">¶</a></h2>
<p>A one-shot behavior is run only once at the earliest opportunity. After execution, the behavior is automatically removed. We have seen an example of the one-shot behavior above.</p>
</div>
<div class="section" id="cyclic-behavior">
<h2>Cyclic behavior<a class="headerlink" href="#cyclic-behavior" title="Permalink to this headline">¶</a></h2>
<p>A cyclic behavior is run repeatedly as long as it is active. The behavior may be blocked and restarted as necessary.</p>
<p>Example:</p>
<div class="highlight-groovy"><div class="highlight"><pre><span class="kd">class</span> <span class="nc">MyAgent</span> <span class="kd">extends</span> <span class="n">Agent</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// a cyclic behavior that runs 5 times and then marks itself as blocked</span>
    <span class="n">add</span> <span class="n">cyclicBehavior</span> <span class="o">{</span>
      <span class="n">agent</span><span class="o">.</span><span class="na">n</span><span class="o">++</span>
      <span class="n">println</span> <span class="s2">&quot;n = ${agent.n}&quot;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">agent</span><span class="o">.</span><span class="na">n</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="o">)</span> <span class="n">block</span><span class="o">()</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Although it may be possible in some cases to access agent methods and fields directly from a behavior method or closure, it is safer to always use an <cite>agent.</cite> qualifier to access them. Without the qualifier, the closure&#8217;s delegation strategy causes the behavior methods and fields to be checked first; this can lead to bugs that are difficult to track.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since behaviors are cooperatively scheduled, they should not block.  Hence <cite>Behavior.block()</cite> is not a blocking call; it simply marks the behavior as blocked and removes it from the list of active behaviors to be scheduled, and continues.</p>
</div>
</div>
<div class="section" id="waker-behavior">
<h2>Waker behavior<a class="headerlink" href="#waker-behavior" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="ticker-behavior">
<h2>Ticker behavior<a class="headerlink" href="#ticker-behavior" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="poisson-behavior">
<h2>Poisson behavior<a class="headerlink" href="#poisson-behavior" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="message-behavior">
<h2>Message behavior<a class="headerlink" href="#message-behavior" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="finite-state-machine-behavior">
<h2>Finite state machine behavior<a class="headerlink" href="#finite-state-machine-behavior" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="test-behavior">
<h2>Test behavior<a class="headerlink" href="#test-behavior" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="custom-behaviors">
<h2>Custom behaviors<a class="headerlink" href="#custom-behaviors" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="messages.html" title="Passing Messages"
             >next</a> |</li>
        <li class="right" >
          <a href="quickstart.html" title="Getting Started"
             >previous</a> |</li>
        <li><a href="index.html">fjåge 1.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Mandar Chitre.
      Last updated on Apr 05, 2013.
    </div>
  </body>
</html>